{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Jersey Customizer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .jersey-viewport {
            width: 100%;
            height: 600px;
            position: relative;
            perspective: 1200px;
            margin: 0 auto;
        }
        
        .jersey-container {
            width: 100%;
            height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            transition: transform 1s ease;
        }
        
        .jersey-side {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f8f9fa;
            border-radius: 10px;
        }
        
        .jersey-back {
            transform: rotateY(180deg);
        }
        
        .jersey-svg {
            max-width: 80%;
            max-height: 80%;
        }
        
        .controls {
            margin-top: 20px;
            text-align: center;
        }
        
        .text-overlay {
            position: absolute;
            text-align: center;
            pointer-events: none;
            font-family: 'Arial', sans-serif;
        }
        
        .name-overlay {
            top: 25%;
            width: 100%;
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .number-overlay {
            top: 40%;
            width: 100%;
            font-size: 72px;
            font-weight: bold;
        }
        
        .back-number-overlay {
            top: 30%;
            width: 100%;
            font-size: 120px;
            font-weight: bold;
        }
        
        .logo-overlay {
            position: absolute;
            top: 15%;
            width: 100%;
            text-align: center;
            pointer-events: none;
        }
        
        .logo-image {
            max-width: 80px;
            max-height: 80px;
        }
        
        .color-swatch {
            width: 30px;
            height: 30px;
            display: inline-block;
            margin: 5px;
            border: 2px solid #ddd;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .color-swatch.active {
            border-color: #000;
        }
        
        .rotation-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .rotation-slider {
            width: 100%;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Advanced Jersey Customizer</h1>
        
        <div class="row">
            <div class="col-lg-8">
                <div class="jersey-viewport">
                    <div class="jersey-container" id="jerseyContainer">
                        <!-- Front Side -->
                        <div class="jersey-side jersey-front">
                            <svg class="jersey-svg" id="frontJerseySvg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                <path class="jersey-body" d="M50,0 L150,0 L150,150 L100,200 L50,150 Z" fill="#ffffff" stroke="#000000" stroke-width="2"/>
                                <path class="jersey-sleeve left-sleeve" d="M50,0 L30,50 L50,50 L50,0 Z" fill="#000000" stroke="#000000" stroke-width="2"/>
                                <path class="jersey-sleeve right-sleeve" d="M150,0 L170,50 L150,50 L150,0 Z" fill="#000000" stroke="#000000" stroke-width="2"/>
                            </svg>
                            <div class="logo-overlay" id="frontLogoOverlay">
                                <img class="logo-image" id="frontLogoImage" style="display: none;">
                            </div>
                            <div class="text-overlay number-overlay" id="frontNumberOverlay"></div>
                        </div>
                        
                        <!-- Back Side -->
                        <div class="jersey-side jersey-back">
                            <svg class="jersey-svg" id="backJerseySvg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                <path class="jersey-body" d="M50,0 L150,0 L150,150 L100,200 L50,150 Z" fill="#ffffff" stroke="#000000" stroke-width="2"/>
                                <path class="jersey-sleeve left-sleeve" d="M50,0 L30,50 L50,50 L50,0 Z" fill="#000000" stroke="#000000" stroke-width="2"/>
                                <path class="jersey-sleeve right-sleeve" d="M150,0 L170,50 L150,50 L150,0 Z" fill="#000000" stroke="#000000" stroke-width="2"/>
                            </svg>
                            <div class="text-overlay name-overlay" id="nameOverlay"></div>
                            <div class="text-overlay back-number-overlay" id="backNumberOverlay"></div>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="rotation-controls">
                        <button class="btn btn-outline-primary" id="showFrontBtn">Front</button>
                        <button class="btn btn-outline-primary" id="showBackBtn">Back</button>
                    </div>
                    <input type="range" class="form-range rotation-slider" id="rotationSlider" min="0" max="180" value="0">
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5>Customize Your Jersey</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Jersey Color</label>
                            <div class="d-flex flex-wrap">
                                <div class="color-swatch active" style="background-color: #ffffff;" data-color="#ffffff" data-target="jersey"></div>
                                <div class="color-swatch" style="background-color: #ff0000;" data-color="#ff0000" data-target="jersey"></div>
                                <div class="color-swatch" style="background-color: #0000ff;" data-color="#0000ff" data-target="jersey"></div>
                                <div class="color-swatch" style="background-color: #00ff00;" data-color="#00ff00" data-target="jersey"></div>
                                <div class="color-swatch" style="background-color: #ffff00;" data-color="#ffff00" data-target="jersey"></div>
                                <div class="color-swatch" style="background-color: #000000;" data-color="#000000" data-target="jersey"></div>
                            </div>
                            <input type="color" class="form-control form-control-color mt-2" id="jerseyColor" value="#ffffff">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Sleeve Color</label>
                            <div class="d-flex flex-wrap">
                                <div class="color-swatch" style="background-color: #ffffff;" data-color="#ffffff" data-target="sleeve"></div>
                                <div class="color-swatch" style="background-color: #ff0000;" data-color="#ff0000" data-target="sleeve"></div>
                                <div class="color-swatch" style="background-color: #0000ff;" data-color="#0000ff" data-target="sleeve"></div>
                                <div class="color-swatch" style="background-color: #00ff00;" data-color="#00ff00" data-target="sleeve"></div>
                                <div class="color-swatch" style="background-color: #ffff00;" data-color="#ffff00" data-target="sleeve"></div>
                                <div class="color-swatch active" style="background-color: #000000;" data-color="#000000" data-target="sleeve"></div>
                            </div>
                            <input type="color" class="form-control form-control-color mt-2" id="sleeveColor" value="#000000">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Player Name</label>
                            <input type="text" class="form-control" id="playerName" placeholder="Enter name" maxlength="15">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Player Number</label>
                            <input type="number" class="form-control" id="playerNumber" placeholder="Enter number" min="0" max="99">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Text Color</label>
                            <div class="d-flex flex-wrap">
                                <div class="color-swatch" style="background-color: #ffffff;" data-color="#ffffff" data-target="text"></div>
                                <div class="color-swatch" style="background-color: #ff0000;" data-color="#ff0000" data-target="text"></div>
                                <div class="color-swatch" style="background-color: #0000ff;" data-color="#0000ff" data-target="text"></div>
                                <div class="color-swatch" style="background-color: #ffff00;" data-color="#ffff00" data-target="text"></div>
                                <div class="color-swatch active" style="background-color: #000000;" data-color="#000000" data-target="text"></div>
                            </div>
                            <input type="color" class="form-control form-control-color mt-2" id="textColor" value="#000000">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Team Logo</label>
                            <input type="file" class="form-control" id="logoUpload" accept="image/*">
                        </div>
                        
                        <div class="mb-3">
                            <button class="btn btn-primary w-100" id="saveDesignBtn">Save Design</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const jerseyContainer = document.getElementById('jerseyContainer');
            const showFrontBtn = document.getElementById('showFrontBtn');
            const showBackBtn = document.getElementById('showBackBtn');
            const rotationSlider = document.getElementById('rotationSlider');
            const jerseyColor = document.getElementById('jerseyColor');
            const sleeveColor = document.getElementById('sleeveColor');
            const playerName = document.getElementById('playerName');
            const playerNumber = document.getElementById('playerNumber');
            const textColor = document.getElementById('textColor');
            const logoUpload = document.getElementById('logoUpload');
            const saveDesignBtn = document.getElementById('saveDesignBtn');
            
            // Text overlays
            const nameOverlay = document.getElementById('nameOverlay');
            const frontNumberOverlay = document.getElementById('frontNumberOverlay');
            const backNumberOverlay = document.getElementById('backNumberOverlay');
            const frontLogoOverlay = document.getElementById('frontLogoOverlay');
            const frontLogoImage = document.getElementById('frontLogoImage');
            
            // Jersey elements
            const jerseyBodies = document.querySelectorAll('.jersey-body');
            const jerseySleeveElements = document.querySelectorAll('.jersey-sleeve');
            
            // Color swatches
            const colorSwatches = document.querySelectorAll('.color-swatch');
            
            // Event listeners
            showFrontBtn.addEventListener('click', () => {
                rotationSlider.value = 0;
                updateRotation();
            });
            
            showBackBtn.addEventListener('click', () => {
                rotationSlider.value = 180;
                updateRotation();
            });
            
            rotationSlider.addEventListener('input', updateRotation);
            
            jerseyColor.addEventListener('input', () => {
                updateJerseyColors('jersey', jerseyColor.value);
                updateColorSwatchActive('jersey', jerseyColor.value);
            });
            
            sleeveColor.addEventListener('input', () => {
                updateJerseyColors('sleeve', sleeveColor.value);
                updateColorSwatchActive('sleeve', sleeveColor.value);
            });
            
            textColor.addEventListener('input', () => {
                updateTextColor(textColor.value);
                updateColorSwatchActive('text', textColor.value);
            });
            
            playerName.addEventListener('input', updatePlayerName);
            playerNumber.addEventListener('input', updatePlayerNumber);
            
            logoUpload.addEventListener('change', handleLogoUpload);
            
            saveDesignBtn.addEventListener('click', saveDesign);
            
            // Color swatch clicks
            colorSwatches.forEach(swatch => {
                swatch.addEventListener('click', function() {
                    const target = this.dataset.target;
                    const color = this.dataset.color;
                    
                    // Update active state
                    document.querySelectorAll(`.color-swatch[data-target="${target}"]`).forEach(s => {
                        s.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Update colors
                    if (target === 'jersey') {
                        jerseyColor.value = color;
                        updateJerseyColors('jersey', color);
                    } else if (target === 'sleeve') {
                        sleeveColor.value = color;
                        updateJerseyColors('sleeve', color);
                    } else if (target === 'text') {
                        textColor.value = color;
                        updateTextColor(color);
                    }
                });
            });
            
            // Functions
            function updateRotation() {
                const rotation = rotationSlider.value;
                jerseyContainer.style.transform = `rotateY(${rotation}deg)`;
                
                // Update button active states
                if (rotation < 90) {
                    showFrontBtn.classList.add('btn-primary');
                    showFrontBtn.classList.remove('btn-outline-primary');
                    showBackBtn.classList.add('btn-outline-primary');
                    showBackBtn.classList.remove('btn-primary');
                } else {
                    showBackBtn.classList.add('btn-primary');
                    showBackBtn.classList.remove('btn-outline-primary');
                    showFrontBtn.classList.add('btn-outline-primary');
                    showFrontBtn.classList.remove('btn-primary');
                }
            }
            
            function updateJerseyColors(target, color) {
                if (target === 'jersey') {
                    jerseyBodies.forEach(body => {
                        body.setAttribute('fill', color);
                    });
                } else if (target === 'sleeve') {
                    jerseySleeveElements.forEach(sleeve => {
                        sleeve.setAttribute('fill', color);
                    });
                }
            }
            
            function updateColorSwatchActive(target, color) {
                // Find if there's a matching swatch
                let matchFound = false;
                document.querySelectorAll(`.color-swatch[data-target="${target}"]`).forEach(swatch => {
                    if (swatch.dataset.color.toLowerCase() === color.toLowerCase()) {
                        swatch.classList.add('active');
                        matchFound = true;
                    } else {
                        swatch.classList.remove('active');
                    }
                });
                
                // If no match found, deactivate all
                if (!matchFound) {
                    document.querySelectorAll(`.color-swatch[data-target="${target}"]`).forEach(swatch => {
                        swatch.classList.remove('active');
                    });
                }
            }
            
            function updatePlayerName() {
                nameOverlay.textContent = playerName.value.toUpperCase();
            }
            
            function updatePlayerNumber() {
                const number = playerNumber.value;
                frontNumberOverlay.textContent = number;
                backNumberOverlay.textContent = number;
            }
            
            function updateTextColor(color) {
                nameOverlay.style.color = color;
                frontNumberOverlay.style.color = color;
                backNumberOverlay.style.color = color;
            }
            
            function handleLogoUpload(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        frontLogoImage.src = e.target.result;
                        frontLogoImage.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            }
            
            function saveDesign() {
                // Create a canvas element
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Set canvas dimensions
                canvas.width = 800;
                canvas.height = 600;
                
                // Draw background
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Create an image from the SVG
                const svgData = new XMLSerializer().serializeToString(
                    rotationSlider.value < 90 ? document.getElementById('frontJerseySvg') : document.getElementById('backJerseySvg')
                );
                const img = new Image();
                img.src = 'data:image/svg+xml;base64,' + btoa(svgData);
                
                img.onload = function() {
                    // Draw the SVG
                    ctx.drawImage(img, 200, 100, 400, 400);
                    
                    // Draw text
                    ctx.font = 'bold 48px Arial';
                    ctx.fillStyle = textColor.value;
                    ctx.textAlign = 'center';
                    
                    if (rotationSlider.value < 90) {
                        // Front view
                        if (playerNumber.value) {
                            ctx.font = 'bold 72px Arial';
                            ctx.fillText(playerNumber.value, 400, 300);
                        }
                        
                        // Draw logo if present
                        if (frontLogoImage.style.display !== 'none') {
                            ctx.drawImage(frontLogoImage, 350, 150, 100, 100);
                        }
                    } else {
                        // Back view
                        if (playerName.value) {
                            ctx.font = 'bold 36px Arial';
                            ctx.fillText(playerName.value.toUpperCase(), 400, 200);
                        }
                        
                        if (playerNumber.value) {
                            ctx.font = 'bold 120px Arial';
                            ctx.fillText(playerNumber.value, 400, 350);
                        }
                    }
                    
                    // Create download link
                    const link = document.createElement('a');
                    link.download = 'custom-jersey.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                };
            }
            
            // Initialize
            updateRotation();
            updatePlayerName();
            updatePlayerNumber();
            updateTextColor(textColor.value);
        });
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

