{% extends 'ecom/customer_base.html' %}
{% load static %}
{% block content %}

<style media="screen">
  /* Base styles */
  body, html {
    height: 100%;
    font-family: 'Poppins', sans-serif;
  }

  body {
    background-color: #f8f9fa;
  }

  /* Utility classes */
  .d-flex {
    display: flex;
  }

  .align-center {
    align-items: center;
  }

  .flex-centerY-centerX {
    justify-content: center;
    align-items: center;
  }

  /* Hero slider */
  .slider-container {
    height: 50vh;
    min-height: 400px;
    width: 100%;
    position: relative;
    overflow: hidden;
    text-align: center;
    margin-bottom: 30px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }

  .menu {
    position: absolute;
    left: 0;
    z-index: 900;
    width: 100%;
    bottom: 20px;
  }

  .menu label {
    cursor: pointer;
    display: inline-block;
    width: 12px;
    height: 12px;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 50px;
    margin: 0 .2em 1em;
    transition: all 0.3s ease;
  }

  .menu label:hover {
    background: #fff;
    transform: scale(1.2);
  }

  .slide {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 100%;
    z-index: 10;
    background-size: cover;
    background-position: center;
    transition: left 0s .75s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .slide-content {
    background-color: rgba(0, 0, 0, 0.5);
    padding: 30px;
    border-radius: 8px;
    max-width: 600px;
    text-align: center;
    color: white;
    transform: translateY(50px);
    opacity: 0;
    transition: all 0.5s ease 0.3s;
  }

  [id^="slide"]:checked + .slide .slide-content {
    transform: translateY(0);
    opacity: 1;
  }

  [id^="slide"]:checked + .slide {
    left: 0;
    z-index: 100;
    transition: left .65s ease-out;
  }

  .slide-1 {
    background-image: url("{% static 'images/b2.webp' %}");
  }

  .slide-2 {
    background-image: url("{% static 'images/b4.webp' %}");
  }

  .slide-3 {
    background-image: url("{% static 'images/b3.webp' %}");
  }

  /* Category tabs */
  .category-tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
  }

  .category-tab {
    padding: 10px 20px;
    margin: 0 5px 10px;
    background-color: #fff;
    border: 2px solid #eee;
    border-radius: 30px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    color: #555;
  }

  .category-tab:hover, .category-tab.active {
    background-color: #3E454C;
    color: white;
    border-color: #3E454C;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  /* Search and filter bar */
  .search-filter-container {
    background-color: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    margin-bottom: 30px;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
  }

  .search-box {
    flex: 1;
    min-width: 250px;
    margin-right: 15px;
    margin-bottom: 10px;
    position: relative;
  }

  .search-box input {
    width: 100%;
    padding: 10px 15px 10px 40px;
    border: 1px solid #ddd;
    border-radius: 30px;
    font-size: 14px;
    transition: all 0.3s;
  }

  .search-box input:focus {
    border-color: #96b3ef;
    box-shadow: 0 0 0 3px rgba(150, 179, 239, 0.2);
    outline: none;
  }

  .search-box i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #aaa;
  }

  .filter-options {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
  }

  .filter-label {
    margin-right: 10px;
    font-weight: 600;
    color: #555;
  }

  .filter-select {
    padding: 8px 15px;
    border: 1px solid #ddd;
    border-radius: 4px;
    background-color: white;
    margin-right: 10px;
    cursor: pointer;
  }

  /* Product grid */
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 25px;
    margin-bottom: 50px;
  }

  /* Product card */
  .product-card {
    background-color: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    position: relative;
    height: 100%;
    display: flex;
    flex-direction: column;
    cursor: pointer;
  }

  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
  }

  .product-image-container {
    position: relative;
    padding-top: 100%; /* 1:1 Aspect Ratio */
    overflow: hidden;
    background-color: #f5f5f5;
  }

  .product-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: all 0.5s ease;
  }

  .product-card:hover .product-image {
    transform: scale(1.05);
  }

  .product-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background-color: #ff6b6b;
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    z-index: 1;
  }

  .product-wishlist {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: white;
    color: #555;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 1;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }

  .product-wishlist:hover {
    color: #ff6b6b;
    transform: scale(1.1);
  }

  .product-details {
    padding: 15px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }

  .product-name {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    margin-bottom: 8px;
    line-height: 1.4;
  }

  .product-description {
    font-size: 14px;
    color: #777;
    margin-bottom: 15px;
    line-height: 1.5;
    flex-grow: 1;
  }

  .product-price {
    font-size: 18px;
    font-weight: 700;
    color: #3E454C;
    margin-bottom: 15px;
  }

  .product-rating {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
  }

  .rating-stars {
    color: #ffc107;
    margin-right: 5px;
  }

  .rating-count {
    font-size: 12px;
    color: #777;
  }

  /* Product options */
  .product-options {
    background-color: white;
    padding: 0;
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transition: all 0.3s ease;
  }

  .product-options.active {
    padding: 15px;
    max-height: 300px;
    opacity: 1;
  }

  .option-group {
    margin-bottom: 15px;
  }

  .option-label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #333;
    font-size: 14px;
  }

  .size-options {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-bottom: 15px;
  }

  .size-option {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s ease;
  }

  .size-option:hover {
    border-color: #96b3ef;
    background-color: #f0f5ff;
  }

  .size-option.selected {
    background-color: #3E454C;
    color: white;
    border-color: #3E454C;
  }

  .quantity-selector {
    display: flex;
    align-items: center;
    width: 120px;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
  }

  .quantity-btn {
    width: 36px;
    height: 36px;
    background-color: #f5f5f5;
    border: none;
    color: #555;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .quantity-btn:hover {
    background-color: #e5e5e5;
  }

  .quantity-input {
    width: 48px;
    height: 36px;
    text-align: center;
    border: none;
    border-left: 1px solid #ddd;
    border-right: 1px solid #ddd;
    font-size: 14px;
  }

  /* Add to cart button */
  .add-to-cart-btn {
    display: block;
    width: 100%;
    padding: 12px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    text-decoration: none;
  }

  .add-to-cart-btn:hover {
    background-color: #2c3238;
    transform: translateY(-2px);
  }

  .add-to-cart-btn i {
    margin-right: 8px;
  }

  /* Quick view overlay */
  .quick-view-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .quick-view-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .quick-view-content {
    background-color: white;
    border-radius: 8px;
    max-width: 900px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    padding: 30px;
    position: relative;
    transform: translateY(50px);
    transition: all 0.3s ease;
  }

  .quick-view-overlay.active .quick-view-content {
    transform: translateY(0);
  }

  .quick-view-close {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 30px;
    height: 30px;
    background-color: #f5f5f5;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 1;
    transition: all 0.2s;
  }

  .quick-view-close:hover {
    background-color: #e5e5e5;
  }

  /* Pagination */
  .pagination {
    display: flex;
    justify-content: center;
    margin-top: 30px;
    margin-bottom: 50px;
  }

  .pagination-item {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 5px;
    border-radius: 4px;
    background-color: white;
    color: #555;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  .pagination-item:hover, .pagination-item.active {
    background-color: #3E454C;
    color: white;
  }

  /* Responsive adjustments */
  @media (max-width: 991px) {
    .slider-container {
      height: 40vh;
    }
  }

  @media (max-width: 767px) {
    .slider-container {
      height: 30vh;
    }
    
    .products-grid {
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
    
    .search-filter-container {
      flex-direction: column;
      align-items: stretch;
    }
    
    .search-box {
      margin-right: 0;
      margin-bottom: 15px;
    }
    
    .filter-options {
      justify-content: space-between;
    }
  }

  @media (max-width: 576px) {
    .products-grid {
      grid-template-columns: 1fr;
    }
    
    .category-tab {
      padding: 8px 15px;
      font-size: 13px;
    }
  }

  /* Animation effects */
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes slideUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .fade-in {
    animation: fadeIn 0.5s ease forwards;
  }

  .slide-up {
    animation: slideUp 0.5s ease forwards;
  }

  /* Product card hover effects */
  .product-card .quick-view-btn {
    position: absolute;
    bottom: -50px;
    left: 50%;
    transform: translateX(-50%);
    background-color: white;
    color: #333;
    padding: 8px 15px;
    border-radius: 4px;
    font-size: 13px;
    font-weight: 600;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    cursor: pointer;
    z-index: 2;
    opacity: 0;
  }

  .product-card:hover .quick-view-btn {
    bottom: 15px;
    opacity: 1;
  }

  .product-card .product-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.2);
    opacity: 0;
    transition: all 0.3s ease;
  }

  .product-card:hover .product-overlay {
    opacity: 1;
  }

/* Add these styles to the CSS section */
.modal-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  z-index: 900;
  display: none;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.modal-backdrop.active {
  display: block;
  opacity: 1;
}

/* New product detail modal styles */
.product-detail-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.product-detail-modal.active {
  opacity: 1;
  visibility: visible;
}

.product-detail-content {
  background-color: white;
  border-radius: 8px;
  width: 90%;
  max-width: 1000px;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
  transform: translateY(30px);
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
}

.product-detail-modal.active .product-detail-content {
  transform: translateY(0);
}

.product-detail-close {
  position: absolute;
  top: 15px;
  right: 15px;
  width: 30px;
  height: 30px;
  background-color: #f5f5f5;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 10;
  transition: all 0.2s;
}

.product-detail-close:hover {
  background-color: #e5e5e5;
}

.product-detail-body {
  display: flex;
  flex-direction: row;
  padding: 0;
}

.product-detail-image {
  width: 50%;
  background-color: #f8f8f8;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  height: 100%;
  overflow: hidden;
}

.product-detail-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.product-detail-info {
  width: 50%;
  padding: 30px;
}

.product-detail-title {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 10px;
  color: #333;
}

.product-detail-price {
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 20px;
  color: #333;
}

.product-detail-description {
  font-size: 14px;
  color: #666;
  margin-bottom: 25px;
  line-height: 1.6;
}

.product-detail-options {
  margin-bottom: 25px;
}

.option-title {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 10px;
  color: #333;
}

.size-option-group {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 5px;
}

.size-option-btn {
  min-width: 45px;
  height: 45px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid #ddd;
  background-color: white;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s ease;
}

.size-option-btn:hover {
  border-color: #333;
}

.size-option-btn.selected {
  background-color: #333;
  color: white;
  border-color: #333;
}

.option-message {
  font-size: 12px;
  color: #999;
  margin-top: 5px;
}

.color-option-group {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 5px;
}

.color-option-btn {
  min-width: 60px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid #ddd;
  background-color: white;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s ease;
}

.color-option-btn:hover {
  border-color: #333;
}

.color-option-btn.selected {
  background-color: #333;
  color: white;
  border-color: #333;
}

.quantity-control {
  display: flex;
  align-items: center;
  margin-bottom: 25px;
}

.quantity-label {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 10px;
  color: #333;
}

.quantity-input-group {
  display: flex;
  align-items: center;
  border: 1px solid #ddd;
  border-radius: 4px;
  overflow: hidden;
}

.quantity-btn {
  width: 40px;
  height: 40px;
  background-color: #f5f5f5;
  border: none;
  color: #333;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.quantity-btn:hover {
  background-color: #e5e5e5;
}

.quantity-input {
  width: 60px;
  height: 40px;
  text-align: center;
  border: none;
  border-left: 1px solid #ddd;
  border-right: 1px solid #ddd;
  font-size: 14px;
}

.add-to-cart-button {
  width: 100%;
  height: 50px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 20px;
}

.add-to-cart-button:hover {
  background-color: #666;
}

.add-to-cart-button i {
  margin-right: 8px;
}

.product-detail-tabs {
  display: flex;
  border-bottom: 1px solid #ddd;
  margin-top: 20px;
}

.product-detail-tab {
  padding: 10px 20px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  color: #666;
  background-color: #f8f8f8;
  border: 1px solid #ddd;
  border-bottom: none;
  border-radius: 4px 4px 0 0;
  margin-right: 5px;
}

.product-detail-tab.active {
  background-color: white;
  color: #333;
  border-bottom: 1px solid white;
  margin-bottom: -1px;
}

.product-detail-tab-content {
  padding: 20px;
  font-size: 14px;
  color: #666;
  line-height: 1.6;
}

.product-specs {
  display: flex;
  flex-wrap: wrap;
  margin-top: 10px;
}

.product-spec {
  width: 50%;
  margin-bottom: 10px;
}

.spec-label {
  font-weight: 600;
  color: #333;
}

.spec-value {
  color: #666;
}

@media (max-width: 768px) {
  .product-detail-body {
    flex-direction: column;
  }
  
  .product-detail-image,
  .product-detail-info {
    width: 100%;
  }
  
  .product-detail-image {
    padding: 10px;
  }
  
  .product-detail-info {
    padding: 20px;
  }
  
  .product-spec {
    width: 100%;
  }
}
</style>

<!-- Hero Slider Section -->
<div class="slider-container">
  <div class="menu">
    <label for="slide-dot-1"></label>
    <label for="slide-dot-2"></label>
    <label for="slide-dot-3"></label>
  </div>

  <input id="slide-dot-1" type="radio" name="slides" checked>
  <div class="slide slide-1">
    <div class="slide-content">
      <h2>Premium Quality Jerseys</h2>
      <p>Discover our collection of high-quality sports jerseys for all ages</p>
      <button class="add-to-cart-btn" style="max-width: 200px; margin: 15px auto 0;">Shop Now</button>
    </div>
  </div>

  <input id="slide-dot-2" type="radio" name="slides">
  <div class="slide slide-2">
    <div class="slide-content">
      <h2>New Arrivals</h2>
      <p>Check out our latest collection of team jerseys</p>
      <button class="add-to-cart-btn" style="max-width: 200px; margin: 15px auto 0;">Explore</button>
    </div>
  </div>

  <input id="slide-dot-3" type="radio" name="slides">
  <div class="slide slide-3">
    <div class="slide-content">
      <h2>Special Offers</h2>
      <p>Limited time discounts on selected items</p>
      <button class="add-to-cart-btn" style="max-width: 200px; margin: 15px auto 0;">View Deals</button>
    </div>
  </div>
</div>

<!-- Category Tabs -->
<div class="container">
  <div class="category-tabs">
    <div class="category-tab active" data-category="all">All Products</div>
    <div class="category-tab" data-category="elementary">Elementary</div>
    <div class="category-tab" data-category="boys">Boys</div>
    <div class="category-tab" data-category="girls">Girls</div>
    <div class="category-tab" data-category="adults">Adults</div>
  </div>

  <!-- Search and Filter Bar -->
  <div class="search-filter-container">
    <div class="search-box">
      <i class="fa fa-search"></i>
      <input type="text" placeholder="Search products...">
    </div>
    <div class="filter-options">
      <span class="filter-label">Sort by:</span>
      <select class="filter-select">
        <option value="featured">Featured</option>
        <option value="price-low">Price: Low to High</option>
        <option value="price-high">Price: High to Low</option>
        <option value="newest">Newest</option>
      </select>
      
      <span class="filter-label">Filter:</span>
      <select class="filter-select">
        <option value="all">All Sizes</option>
        <option value="xs">XS</option>
        <option value="s">S</option>
        <option value="m">M</option>
        <option value="l">L</option>
        <option value="xl">XL</option>
      </select>
    </div>
  </div>

  <!-- Products Grid -->
  {% if products %}
  <h3 class="text-center mb-4" style="color:#3E454C; font-weight: 600;">{{ word }}</h3>

  <!-- Product data for modal logic -->
  <script>
    var productStockData = {
      {% for product in products %}
        "{{ product.id }}": {{ product.get_size_stock_json|safe }},
      {% endfor %}
    };
    var productInfoData = {
      {% for product in products %}
        "{{ product.id }}": {
          id: "{{ product.id }}",
          name: "{{ product.name|escapejs }}",
          price: "{{ product.price }}",
          description: "{{ product.description|escapejs }}",
          image: "{% if product.product_image %}{{ product.product_image.url }}{% endif %}"
        },
      {% endfor %}
    };
    var sizeLabels = { S: 'Small', XS: 'Extra Small', M: 'Medium', L: 'Large', XL: 'Extra Large' };
    var sizeOrder = ['XS', 'S', 'M', 'L', 'XL'];
  </script>

  <div class="products-grid">
    {% for product in products %}
    <div class="product-card" data-product-id="{{ product.id }}">
      <div class="product-image-container">
        <img src="{{ product.product_image.url }}" alt="{{ product.name }}" class="product-image">
        <button class="quick-view-btn" onclick="openProductDetail('{{ product.id }}')">Quick View</button>
      </div>
      <div class="product-details">
        <div class="product-name">{{ product.name }}</div>
        <div class="product-description">{{ product.description }}</div>
        <div class="product-price">₱{{ product.price }}</div>
      </div>
    </div>
    {% endfor %}
  </div>
  <!-- Pagination -->
  <div class="pagination">
  </div>
  
  {% else %}
  <div class="text-center py-5">
    <i class="fa fa-search fa-4x mb-3 text-muted"></i>
    <h3 style="color:#3E454C;">No Products Found</h3>
    <p class="text-muted">Try adjusting your search or filter to find what you're looking for.</p>
  </div>
  {% endif %}
</div>

<!-- Product Detail Modal -->
<div class="product-detail-modal" id="productDetailModal">
  <div class="product-detail-content" id="productDetailContent">
    <!-- Content will be injected by JS -->
  </div>
</div>

<!-- Notification messages (Django messages) -->
{% if messages %}
  <script>
    {% for message in messages %}
      showNotification("{{ message|escapejs }}");
    {% endfor %}
  </script>
{% endif %}

<script>
  // Functions for size and quantity selectors
  function selectSize(element, size, productId) {
    // Remove selected class from all size options in the same container
    const container = element.closest('.size-options');
    const options = container.querySelectorAll('.size-option');
    options.forEach(option => option.classList.remove('selected'));
    
    // Add selected class to clicked element
    element.classList.add('selected');
    
    // Update the hidden input value
    document.getElementById('size-input-' + productId).value = size;
    
    // Reset any error styling
    container.style.border = 'none';
  }

  function incrementQuantity(productId) {
    const input = document.getElementById('quantity-input-' + productId);
    const currentValue = parseInt(input.value);
    if (currentValue < 10) {
      input.value = currentValue + 1;
    }
  }

  function decrementQuantity(productId) {
    const input = document.getElementById('quantity-input-' + productId);
    const currentValue = parseInt(input.value);
    if (currentValue > 1) {
      input.value = currentValue - 1;
    }
  }
  
  // Product detail modal functions
  function selectDetailSize(element, size) {
    // Remove selected class from all size options
    const options = document.querySelectorAll('.size-option-btn');
    options.forEach(option => option.classList.remove('selected'));
    
    // Add selected class to clicked element
    element.classList.add('selected');
    
    // Update the hidden input value
    document.getElementById('detail-size-input').value = size;
  }
  
  function incrementDetailQuantity() {
    const input = document.getElementById('detail-quantity-input');
    const currentValue = parseInt(input.value);
    if (currentValue < 10) {
      input.value = currentValue + 1;
    }
  }
  
  function decrementDetailQuantity() {
    const input = document.getElementById('detail-quantity-input');
    const currentValue = parseInt(input.value);
    if (currentValue > 1) {
      input.value = currentValue - 1;
    }
  }
  
  function switchTab(element, tabId) {
    // Remove active class from all tabs
    const tabs = document.querySelectorAll('.product-detail-tab');
    tabs.forEach(tab => tab.classList.remove('active'));
    
    // Add active class to clicked tab
    element.classList.add('active');
    
    // Hide all tab content
    const tabContents = document.querySelectorAll('.product-detail-tab-content');
    tabContents.forEach(content => content.style.display = 'none');
    
    // Show selected tab content
    document.getElementById('tab-' + tabId).style.display = 'block';
  }
  
  function openProductDetail(productId) {
    var product = productInfoData[productId];
    var stock = productStockData[productId];
    var modal = document.getElementById('productDetailModal');
    var content = document.getElementById('productDetailContent');
    var firstAvailableSize = null;
    var sizeButtons = '';
    sizeOrder.forEach(function(size) {
      var stockCount = stock[size] || 0;
      var disabled = stockCount < 1 ? 'disabled' : '';
      var outOfStock = stockCount < 1 ? ' (Out of stock)' : ' (' + stockCount + ' in stock)';
      if (!firstAvailableSize && stockCount > 0) firstAvailableSize = size;
      sizeButtons += `<button type="button" class="size-option-btn" data-size="${size}" ${disabled}>${sizeLabels[size]}${outOfStock}</button>`;
    });
    var html = `
      <span class="product-detail-close" onclick="closeProductDetail()"><i class="fa fa-times"></i></span>
      <div class="product-detail-body">
        <div class="product-detail-image">
          <img src="${product.image}" alt="${product.name}">
        </div>
        <div class="product-detail-info">
          <div class="product-detail-title">${product.name}</div>
          <div class="product-detail-price">₱${product.price}</div>
          <div class="product-detail-description">${product.description}</div>
          <div class="product-detail-options">
            <div class="option-title">Select Size</div>
            <div class="size-option-group" id="modalSizeOptions">
              ${sizeButtons}
            </div>
            <div class="option-message" id="modalStockMessage"></div>
          </div>
          <div class="quantity-control">
            <span class="quantity-label">Quantity</span>
            <div class="quantity-input-group">
              <button class="quantity-btn" id="modalQtyMinus">-</button>
              <input type="number" class="quantity-input" id="modalQtyInput" value="1" min="1">
              <button class="quantity-btn" id="modalQtyPlus">+</button>
            </div>
          </div>
          <button class="add-to-cart-button" id="modalAddToCartBtn"><i class="fa fa-shopping-cart"></i> Add to Cart</button>
        </div>
      </div>
    `;
    content.innerHTML = html;
    modal.classList.add('active');

    // Modal state
    var selectedSize = firstAvailableSize;
    var maxQty = selectedSize ? stock[selectedSize] : 0;
    var qtyInput = document.getElementById('modalQtyInput');
    var addToCartBtn = document.getElementById('modalAddToCartBtn');
    var stockMsg = document.getElementById('modalStockMessage');
    var sizeBtns = document.querySelectorAll('#modalSizeOptions .size-option-btn');

    // Highlight first available size
    sizeBtns.forEach(function(btn) {
      if (btn.getAttribute('data-size') === selectedSize) btn.classList.add('selected');
      btn.addEventListener('click', function() {
        if (btn.hasAttribute('disabled')) return;
        sizeBtns.forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedSize = btn.getAttribute('data-size');
        maxQty = stock[selectedSize];
        qtyInput.value = 1;
        updateStockMsg();
        updateAddToCartBtn();
      });
    });

    // Quantity controls
    document.getElementById('modalQtyMinus').onclick = function() {
      var v = parseInt(qtyInput.value);
      if (v > 1) qtyInput.value = v - 1;
      updateAddToCartBtn();
    };
    document.getElementById('modalQtyPlus').onclick = function() {
      var v = parseInt(qtyInput.value);
      if (v < maxQty) qtyInput.value = v + 1;
      updateAddToCartBtn();
    };
    qtyInput.oninput = function() {
      var v = parseInt(qtyInput.value);
      if (isNaN(v) || v < 1) qtyInput.value = 1;
      else if (v > maxQty) qtyInput.value = maxQty;
      updateAddToCartBtn();
    };

    // Add to cart button logic
    function updateAddToCartBtn() {
      if (!selectedSize || maxQty < 1) {
        addToCartBtn.disabled = true;
        addToCartBtn.innerHTML = '<i class="fa fa-shopping-cart"></i> Out of Stock';
      } else if (parseInt(qtyInput.value) > maxQty) {
        addToCartBtn.disabled = true;
        addToCartBtn.innerHTML = '<i class="fa fa-shopping-cart"></i> Not enough stock';
      } else {
        addToCartBtn.disabled = false;
        addToCartBtn.innerHTML = '<i class="fa fa-shopping-cart"></i> Add to Cart';
      }
    }
    function updateStockMsg() {
      if (!selectedSize) {
        stockMsg.textContent = 'Please select a size.';
      } else if (maxQty < 1) {
        stockMsg.textContent = 'Selected size is out of stock.';
      } else {
        stockMsg.textContent = maxQty + ' in stock for ' + sizeLabels[selectedSize] + '.';
      }
    }
    updateStockMsg();
    updateAddToCartBtn();

    // Add to cart click
    addToCartBtn.onclick = function() {
      if (addToCartBtn.disabled) return;
      // Submit via form or AJAX as needed
      var form = document.createElement('form');
      form.method = 'POST';
      form.action = '/add-to-cart/' + product.id + '/';
      var csrf = document.createElement('input');
      csrf.type = 'hidden';
      csrf.name = 'csrfmiddlewaretoken';
      csrf.value = '{{ csrf_token }}';
      form.appendChild(csrf);
      var sizeInput = document.createElement('input');
      sizeInput.type = 'hidden';
      sizeInput.name = 'size';
      sizeInput.value = selectedSize;
      form.appendChild(sizeInput);
      var qtyInputEl = document.createElement('input');
      qtyInputEl.type = 'hidden';
      qtyInputEl.name = 'quantity';
      qtyInputEl.value = qtyInput.value;
      form.appendChild(qtyInputEl);
      document.body.appendChild(form);
      form.submit();
    };
  }

  function closeProductDetail() {
    document.getElementById('productDetailModal').classList.remove('active');
    document.getElementById('productDetailContent').innerHTML = '';
  }

  // Category tabs functionality
  document.addEventListener('DOMContentLoaded', function() {
    const categoryTabs = document.querySelectorAll('.category-tab');
    const productCards = document.querySelectorAll('.product-card');
    
    categoryTabs.forEach(tab => {
      tab.addEventListener('click', function() {
        // Remove active class from all tabs
        categoryTabs.forEach(t => t.classList.remove('active'));
        
        // Add active class to clicked tab
        this.classList.add('active');
        
        const category = this.dataset.category;
        
        // Show/hide products based on category
        productCards.forEach(card => {
          if (category === 'all' || card.dataset.category === category) {
            card.style.display = 'block';
            // Add animation
            card.classList.add('fade-in');
            setTimeout(() => {
              card.classList.remove('fade-in');
            }, 500);
          } else {
            card.style.display = 'none';
          }
        });
      });
    });
    
    // Make product cards clickable to open detail modal
    productCards.forEach(card => {
      // Add click event directly to the card
      card.addEventListener('click', function(e) {
        // Don't trigger if clicking on the wishlist icon
        if (e.target.closest('.product-wishlist') || 
            e.target.closest('.quick-view-btn') ||
            e.target.tagName === 'A' || 
            e.target.tagName === 'BUTTON' || 
            e.target.tagName === 'INPUT' || 
            e.target.closest('form')) {
          return;
        }
        
        // Get the product ID and open the modal
        const productId = this.dataset.productId;
        openProductDetail(productId);
      });
    });
    
    // Add form validation for detail modal
    const detailForm = document.getElementById('detail-add-to-cart-form');
    detailForm.addEventListener('submit', function(e) {
      const sizeInput = this.querySelector('#detail-size-input');
      
      if (!sizeInput.value) {
        e.preventDefault();
        alert('Please select a size');
      }
    });
    
    // Close modal on ESC key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeProductDetail();
      }
    });

    // Close modal when clicking outside
    document.addEventListener('click', function(e) {
      const modal = document.getElementById('productDetailModal');
      if (modal.classList.contains('active') && !e.target.closest('.product-detail-content') && !e.target.closest('.product-card')) {
        closeProductDetail();
      }
    });

    // Initialize New badges based on upload date
    function initializeNewBadges() {
      const productCards = document.querySelectorAll('.product-card');
      
      productCards.forEach(card => {
        const uploadDate = new Date(card.dataset.uploadDate);
        const currentDate = new Date();
        const diffTime = Math.abs(currentDate - uploadDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        const badge = card.querySelector('.product-badge');
        if (badge) {
          if (diffDays <= 3) {
            badge.style.display = 'block';
          } else {
            badge.style.display = 'none';
          }
        }
      });
    }

    // Call this function when the DOM is loaded
    initializeNewBadges();
  });
  
  // Nice notification instead of alert
  function showNotification(message) {
    // Create notification element
    const notification = document.createElement('div');
    notification.style.position = 'fixed';
    notification.style.top = '20px';
    notification.style.right = '20px';
    notification.style.backgroundColor = '#3E454C';
    notification.style.color = 'white';
    notification.style.padding = '15px 25px';
    notification.style.borderRadius = '4px';
    notification.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
    notification.style.zIndex = '9999';
    notification.style.transform = 'translateX(100%)';
    notification.style.opacity = '0';
    notification.style.transition = 'all 0.3s ease';
    notification.innerHTML = `
      <div style="display: flex; align-items: center;">
        <i class="fa fa-check-circle" style="margin-right: 10px; font-size: 20px;"></i>
        <span>${message}</span>
      </div>
    `;
    
    // Add to DOM
    document.body.appendChild(notification);
    
    // Trigger animation
    setTimeout(() => {
      notification.style.transform = 'translateX(0)';
      notification.style.opacity = '1';
    }, 100);
    
    // Remove after 5 seconds
    setTimeout(() => {
      notification.style.transform = 'translateX(100%)';
      notification.style.opacity = '0';
      setTimeout(() => {
        document.body.removeChild(notification);
      }, 300);
    }, 5000);
  }
  
  // Search functionality
  document.querySelector('.search-box input').addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    const productCards = document.querySelectorAll('.product-card');
    
    productCards.forEach(card => {
      const productName = card.querySelector('.product-name').textContent.toLowerCase();
      const productDesc = card.querySelector('.product-description').textContent.toLowerCase();
      
      if (productName.includes(searchTerm) || productDesc.includes(searchTerm)) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  });
  
  // Sort functionality
  document.querySelector('.filter-select').addEventListener('change', function() {
    const sortValue = this.value;
    const productsGrid = document.querySelector('.products-grid');
    const productCards = Array.from(document.querySelectorAll('.product-card'));
    
    // Sort products based on selected option
    productCards.sort((a, b) => {
      const priceA = parseFloat(a.querySelector('.product-price').textContent.replace('₱', ''));
      const priceB = parseFloat(b.querySelector('.product-price').textContent.replace('₱', ''));
      
      if (sortValue === 'price-low') {
        return priceA - priceB;
      } else if (sortValue === 'price-high') {
        return priceB - priceA;
      }
      
      // Default to original order for 'featured' and 'newest'
      return 0;
    });
    
    // Re-append sorted products
    productCards.forEach(card => {
      productsGrid.appendChild(card);
    });
  });

  // Wishlist functionality
  function toggleWishlist(element, event) {
    event.stopPropagation(); // Prevent opening the product detail modal
    
    const card = element.closest('.product-card');
    const icon = element.querySelector('i');
    const grid = document.querySelector('.products-grid');
    
    if (icon.classList.contains('fa-heart-o')) {
      // Add to wishlist
      icon.classList.remove('fa-heart-o');
      icon.classList.add('fa-heart');
      element.style.color = '#ff6b6b';
      
      // Store current position if not already stored
      if (!card.dataset.currentPosition) {
        card.dataset.currentPosition = Array.from(grid.children).indexOf(card);
      }
      
      // Move to the top of the grid
      grid.prepend(card);
    } else {
      // Remove from wishlist
      icon.classList.remove('fa-heart');
      icon.classList.add('fa-heart-o');
      element.style.color = '#555';
      
      // Get original position
      const originalPosition = parseInt(card.dataset.originalPosition) - 1;
      
      // Find where to insert the card
      const cards = Array.from(grid.children);
      let insertBeforeElement = null;
      
      for (let i = 0; i < cards.length; i++) {
        const pos = parseInt(cards[i].dataset.originalPosition) - 1;
        if (pos > originalPosition) {
          insertBeforeElement = cards[i];
          break;
        }
      }
      
      // Insert at the correct position or append if it should go at the end
      if (insertBeforeElement) {
        grid.insertBefore(card, insertBeforeElement);
      } else {
        grid.appendChild(card);
      }
      
      // Clear current position
      delete card.dataset.currentPosition;
    }
  }
</script>
{% endblock content %}
